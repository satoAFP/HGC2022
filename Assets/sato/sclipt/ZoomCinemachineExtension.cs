using Cinemachine;
using UnityEngine;

/// <summary>
/// マウスホイールによるズームを行えるようにする拡張
/// </summary>
/// 

public class ZoomCinemachineExtension : CinemachineExtension
{
    [SerializeField] private Vector3 zome;

    private int _scrollDelta;
    private float _adjustAngle;
    
    public CinemachineVirtualCamera avcam;

    // カメラワーク処理
    protected override void PostPipelineStageCallback(
        CinemachineVirtualCameraBase vcam,
        CinemachineCore.Stage stage,
        ref CameraState state,
        float deltaTime
    )
    {
        //最初の引きから寄りになるカメラの処理
        //グレゴリーさん感謝
        var transposer = avcam.GetCinemachineComponent<CinemachineTransposer>();
        if ((transposer.m_FollowOffset.y >= 2.5))
            transposer.m_FollowOffset -= zome;

    }

    // マウスホイール操作チェック
    private void Update()
    {
        // マウスホイールの移動量取得
        var delta = Input.mouseScrollDelta.y;
        if (Mathf.Approximately(delta, 0))
            return;

        // 移動量を保持
        _scrollDelta = (int)delta;
    }
}